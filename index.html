<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Rokfor by Rokfor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Rokfor</h1>
      <h2 class="project-tagline">Rokfor CMS: Api First CMS without any opinions towards content rendering</h2>
      <a href="https://github.com/Rokfor/rokfor-slim" class="btn">View on GitHub</a>
      <a href="https://github.com/Rokfor/rokfor-slim/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Rokfor/rokfor-slim/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p>Rokfor build based on <a href="http://slimframework.com/">Slim Framework</a> for PHP. 
Rokfor is a api-first, data centristic content management. It currently
features:</p>

<ul>
<li>  Flexible structures called "Books", divided into parts, called "Chapters".</li>
<li>  Every book can have multiple instances called "Issues".</li>
<li>  Every Chapter contains data, called "Contributions".</li>
<li>  "Contributions" are collections of fields, gathered in templates.</li>
<li>  Various data types supported: Text, Text Arrays, RTF Text, Tables, Numbers,
Dates, Locations, Image and File uploads, Tags, Selectors, Sliders, Two Way
Sliders.</li>
<li>  Various data relations: field to fields, field to structures, fixed values
and many more.</li>
<li>  Read only api with a simple bearer-key authentification based on user
rights.</li>
<li>  Fine grained roles and rights system.</li>
<li>  Installable via composer, using grunt and bower as build system.</li>
</ul>

<p><img src="//rokfor-screenshots/rf-dashboard.png" alt="Dashboard"></p>

<p>Rokfor has already a longer history. The <a href="https://github.com/Rokfor/rokfor-cms">old build</a> 
was mainly used to create printed matter. In order to make it more useful for the public, we 
decided to rewrite it completely applying a modern way of writing php applications:</p>

<ul>
<li>  Composer install system</li>
<li>  AdminLTE backend theme</li>
<li>  Propel ORM</li>
</ul>

<h2>
<a id="setup-and-installation" class="anchor" href="#setup-and-installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setup and Installation</h2>

<h3>
<a id="1-prerequisites" class="anchor" href="#1-prerequisites" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. Prerequisites</h3>

<ul>
<li>  MySQL Database: Server, username, password and database name</li>
<li>  PHP &gt;= 5.5</li>
<li>  <a href="https://getcomposer.org">Composer</a>
</li>
</ul>

<h3>
<a id="2-install-dependencies" class="anchor" href="#2-install-dependencies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2. Install Dependencies</h3>

<p>Clone the repository and install the dependencies with composer:</p>

<pre><code>$ git clone https://github.com/Rokfor/rokfor-slim.git
$ cd rokfor-slim
$ composer install
$ composer update
</code></pre>

<h3>
<a id="3-configuration" class="anchor" href="#3-configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3. Configuration</h3>

<p>First, create copies of the database and settings configuration file. Rename or
copy the *.local.php to *.php files:</p>

<pre><code>$ cd config
$ cp database.local.php database.php
$ cp settings.local.php settings.php
</code></pre>

<p>The options in the <strong>settings.php</strong> file don't need to be changed as long as you keep
the directory structure. Talking about <strong>directories</strong>: Make sure, that the webserver 
has access to the <em>udb</em> and <em>cache</em> folder:</p>

<pre><code>public         _Webserver Document Root_
| index.php    
| udb          _Default Storage directory, chmod r/w for the webserver_
| assets
config         _Configuration Files_
locale         _Localization Files, currently only german_
cache          _Template Cache_
src            _Rokfor PHP Runtime Sources_
vendor         _Composer Dependencies_
templates      _Jade Templates_
build          _Css and Javascript Sources_
</code></pre>

<p>Second, you need to change the database settings in <strong>database.php</strong>. To achieve that,
you need to know the User, Password, Database and Server for your MySQL Account.
If you enable <strong>versioning</strong> in the configuration file, all changes of contributions
are tracked. This is useful in cases you want to keep the editing history. As a downside,
it will create a lot of data.
If you change the log <strong>level</strong> to \Monolog\Logger::DEBUG, all sql queries are
logged. The path to the log file can be adjusted in the <strong>log</strong> setting.</p>

<pre><code>// Database settings

return [
  'host'      =&gt; 'localhost',                     // Server Address
  'user'      =&gt; '',                              // User Name
  'pass'      =&gt; '',                              // Password
  'dbname'    =&gt; '',                              // Database Name
  'log'       =&gt; __DIR__ . '/../logs/propel.log', // Log File for Propel
  'level'     =&gt; \Monolog\Logger::ERROR,          // Error Level
  'versioning'=&gt; false,                           // Store Versions of  
                                                  // Contributions and Data
  //'socket'  =&gt; '/tmp/mysql.sock',               // Unix Socket, normally
                                                  // not needed
  //'port'    =&gt; 3306,                            // Port, if default not needed
];
</code></pre>

<h3>
<a id="4-populate-database" class="anchor" href="#4-populate-database" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>4. Populate Database</h3>

<p><strong>Normally, the database is initialized when you log in for the first time. If no
error occured, you can skip this chapter.</strong></p>

<p>Rokfor relies on <a href="http://propelorg.org">Propel</a> as database object mapper.
Propel is loaded via composer and installed like all other dependencies in the
vendor subdirectory. The connection between rokfor and Propel is established with
<a href="https://github.com/rokfor/rokfor-php-db">rokfor-php-db</a>.</p>

<p>You need to run the <strong>Propel CLI</strong> tool to populate the database. Propel needs to
know how to access your database. This is done in the configuration file.
Edit the connection settings in the <strong>propel.yaml</strong> file similar to the
configuration file above. Change server, database, user and password and save
the file:</p>

<pre><code>$ pico vendor/rokfor/db/config/propel.yaml

dsn: mysql:host=SERVER;dbname=DBNAME;unix_socket=/tmp/mysql.sock;
user: USERNAME
password: PASSWORD
</code></pre>

<p>Now you are ready to run the <strong>Propel CLI</strong> utility with the <strong>insert</strong> parameter. 
The command below assumes that you are still in the directory where you checked out
rokfor-slim:</p>

<pre><code>$ ./vendor/bin/propel sql:insert \
--config-dir ./vendor/rokfor/db/config \
--sql-dir ./vendor/rokfor/db/config/generated-sql/
</code></pre>

<p>Now, the database should be populated with the correct strucuture and a default
user is automatically added (Username: root, Password: 123).</p>

<h2>
<a id="running-rokfor" class="anchor" href="#running-rokfor" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Running Rokfor</h2>

<h3>
<a id="php-server-mode-debug" class="anchor" href="#php-server-mode-debug" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PHP Server Mode (Debug)</h3>

<pre><code>$ cd rokfor-slim (base directory of the repository)
$ php -S 0.0.0.0:8080 -t public public/index.php
</code></pre>

<p>Now you should be able to browse to <strong>http://localhost:8080/rf</strong> and log in with
the default user <strong>root</strong> and password <strong>123</strong>.</p>

<h3>
<a id="behind-apache" class="anchor" href="#behind-apache" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Behind Apache</h3>

<p>There are 3 important things to keep in mind when running Rokfor with Apache:
1. Make sure that the webserver has read/write access to both <strong>cache</strong> und <strong>udb</strong> directory
2. The server's document_root needs to point to the <strong>public</strong> directory. If you can not change this,
rename the directory according to your server configuration and reconfigure the settings.php file.
3. <strong>mod_rewrite</strong> is also necessary to redirect all traffic over <strong>index.html</strong>.</p>

<h2>
<a id="building-rokfor" class="anchor" href="#building-rokfor" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Building Rokfor</h2>

<p>Rokfor uses grunt to build and bower to install dependencies. Assuming you have
installed node and npm:</p>

<pre><code>$ npm install
$ bower install
$ grunt
</code></pre>

<p>The grunt task minifies the css files and creates the javascript bundles and copies
all files into the public directory. Building is only needed if you want to develop
and contribute something to Rokfor.</p>

<h2>
<a id="get-some-data-read-only-api" class="anchor" href="#get-some-data-read-only-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get some Data: Read Only API</h2>

<h3>
<a id="access-key" class="anchor" href="#access-key" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Access Key</h3>

<p>In order to access data, you need to set a user and define a read only api key
in the user profile. Adding a user is only possible if you are signed in as
root. There are two reasons why we use api keys for read only access. First, you
can define which data is published, second, a key is not a password. Even by
publishing a key, there's no way to log into the system and edit content.</p>

<p>Sending the key is done via a bearer authentification header or a access_token
query string. Sending a header is probably a better solution since the query
string won't be too cluttered and the api key probably does not show up in the
server log. The GET-call is probably a little bit more difficult to generate
though.</p>

<pre><code>GET /api/contributions/1/1?access_token=[key]

$ curl -H "Authorization: Bearer [key]" http://localhost:8080/api/contributions/1/1
</code></pre>

<h3>
<a id="current-api-routes" class="anchor" href="#current-api-routes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Current API Routes</h3>

<p><strong>Loading a collection of contributions with options:</strong></p>

<pre><code>GET /api/contributions/:issueid|:issueid-:issueid.../:chapterid|:chapterid-:chapterid...?[options]

Options:

- query=string                                                (default: empty)
- filter=[id|date|sort|templateid[s]]:[lt[e]|gt[e]|eq|like]   (default: [omitted]:like)
- sort=[[id|date|name|sort]|chapter|issue|templateid[s]]:[asc|desc]           (default: sort:asc)
- limit=int                                                   (default: empty)
- offset=int                                                  (default: empty)
- data=[Fieldname|Fieldname|XX]                               (default: empty)
- populate=true|false                                         (default: false)
- verbose=true|false                                          (default: false)
- template=id                                                 (default: empty)
- status=draft|published|both                                 (default: published)

</code></pre>

<ul>
<li>  Query: search for a string within the contribution name or the text fields
Special queries: date:now is transformed into the current time stamp</li>
<li>  Filter: Applies the search string passed in query to certain fields, to the creation
date, the contribution id or sort number.
By default (if fields are omitted) the search query is applied to the name of the 
contribution and its content fields (full text search).
Furthermore, the comparison can be defined with equal, less than, greater than
or like (eq,lt,lte,gt,gte,like). Less and greater than does automatically cast
a string to a number.</li>
<li>  Sort: Sort the results by id, date, name or manual sort number (sort) either 
ascending or descending. It is also possible to sort by a custom id of a template field.
Contributions can also be sorted by chapter or issue.
Please note: You need to choose between id, date, name and sort. You can add one
custom sort field and the chapter and issue flag. i.E:
sort=date|chapter|issue|23 would sort by date, chapter, issue and the custom field 23.</li>
<li>  Limit and Offset: Create pages with a length of [limit] elements starting at
[offset].</li>
<li>  Data: Add additional field infos to the result set of a contributions.
For example, you need the title field of a contribution already in the
result set to create a multilingual menu. Or you need all images for a
slideshow over multiple contributions.</li>
<li>  Populate: Sends all data (true). Equals data=All|Available|Fields</li>
<li>  Verbose: Send complete Information about a dataset. In most cases, this 
is too much and just slowing down the connection.</li>
<li>  Template: limit to a certain template id</li>
<li>  Status: Including draft contributions, published contributions or both. Open
Contributions are never shown.</li>
</ul>

<p>Examples:</p>

<p>GET /api/contributions/1/14-5?query=New+York</p>

<pre><code>Searches for all contributions within issue 1 and chapters 14 and 5 for the String "New York".
</code></pre>

<p>GET /api/contributions/1/14-5?query=New+York&amp;filter=1|6:eq</p>

<pre><code>Searches for all contributions within issue 1 and chapters 14 and 5 for the exact String "New York" within both fields with the template id 1 and 6.
</code></pre>

<p>GET /api/contributions/1/14-5?query=12&amp;filter=sort:gtlimit=1</p>

<pre><code>Searches for all contributions within issue 1 and chapters 14 and 5 with a sort value &gt; 12 and a limitation to 1 item. This represents the next contribution in a manually sorted list, since the list is has a default sort order by 'sort, asc'.
</code></pre>

<p>GET /api/contributions/1/14-5?query=12&amp;filter=sort:lt&amp;sort=sort:desc&amp;limit=1</p>

<pre><code>Searches for all contributions within issue 1 and chapters 14 and 5 with a sort value &lt; 12 and a limitation to 1 item, order descending. This represents the previous contribution in a manually sorted list.
</code></pre>

<p>GET /api/contributions/12/19?limit=10&amp;offset=20</p>

<pre><code>Returns 10 contributions of issue 12 and chapter 19 starting after contribution 20.
</code></pre>

<p>GET /api/contributions/5-6-7/1-2-3?sort=date:desc&amp;data=Title|Subtitle</p>

<pre><code>Returns all contributions of issue 5, 6 and 7 and chapter 1, 2 and 3 ordered by date, descending. Additionally, populates each contribution entry with the content of the fields Title and Subtitle.
</code></pre>

<p>GET /api/contributions/1/1?populate=true&amp;verbose=true</p>

<pre><code>Returns all contributions of chapter 1 and issue 1. Adds all fields to each contribution and additionally prints a lot of information to each field and contribution.
</code></pre>

<p>GET /api/contributions/1/1?template=12</p>

<pre><code>Returns all contributions of chapter 1 and issue 1 based on the template 12
</code></pre>

<p><strong>Loading a single contribution:</strong></p>

<pre><code>GET /api/contribution/:id?[options]

Options:

- verbose=true|false                   (default: false)

</code></pre>

<ul>
<li>  Verbose: Send complete Information about a dataset. In most cases, this 
is too much and just slowing down the connection.</li>
</ul>

<p>Examples:</p>

<p>GET /api/contributions/12?verbose=true</p>

<pre><code>Loads all available data from contribution with the id 12
</code></pre>

<p><strong>Structural Queries</strong></p>

<pre><code>GET /api/books|issues|chapters/[:id]?[options]

Options:

- data=[Fieldname|Fieldname|XX]        (default: empty)
- populate=true|false                  (default: false)
- verbose=true|false                   (default: false)

</code></pre>

<ul>
<li>  Data: Add additional field infos to the result set of a contributions.
For example, you need the title field of a contribution already in the
result set to create a multilingual menu. Or you need all images for a
slideshow over multiple contributions.</li>
<li>  Populate: Sends all data (true). Equals data=All|Available|Fields</li>
<li>  Verbose: Send complete Information about a dataset. In most cases, this 
is too much and just slowing down the connection.</li>
</ul>

<p>Examples:</p>

<p>GET /api/books</p>

<pre><code>Shows all books available for the current api key
</code></pre>

<p>GET /api/chapters/3</p>

<pre><code>Shows all information about chapter 3
</code></pre>

<p>GET /api/issue/2?verbose=true&amp;populate=true</p>

<pre><code>Shows all information about issue 2. Additionally, raises the verbosity level and populates all data fields if a issue has backreferences to contributions.
</code></pre>

<h2>
<a id="roadmap" class="anchor" href="#roadmap" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Roadmap</h2>

<p>In the current state, Rokfor is able to store and organize data. On the roadmap
there are additional functions which will be implemented:</p>

<ul>
<li>Read / write api with jwt authentification.<br>
</li>
<li>Batch functions: Run custom actions over all contributions of a certain chapter.</li>
<li>Field processors: Run an action when storing data.<br>
</li>
<li>Exporters: Convert data into other formats (i.e. PDF)</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/Rokfor/rokfor-slim">Rokfor</a> is maintained by <a href="https://github.com/Rokfor">Rokfor</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
